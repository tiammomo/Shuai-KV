# Shuai-KV Docker Compose 配置
# 使用方式: docker-compose up -d
# 查看日志: docker-compose logs -f

services:
  shuaikv-1:
    build: .
    container_name: shuaikv-1
    ports:
      - "9001:9001"
    volumes:
      - shuaikv1-data:/data
    environment:
      - SHUAIKV_PORT=9001
      - SHUAIKV_NODE_ID=1
    networks:
      shuaikv-net:
        ipv4_address: 172.28.0.10
    healthcheck:
      test: ["CMD", "nc", "-zv", "localhost", "9001"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

  shuaikv-2:
    build: .
    container_name: shuaikv-2
    ports:
      - "9002:9001"
    volumes:
      - shuaikv2-data:/data
    environment:
      - SHUAIKV_PORT=9001
      - SHUAIKV_NODE_ID=2
    networks:
      shuaikv-net:
        ipv4_address: 172.28.0.11
    depends_on:
      - shuaikv-1
    healthcheck:
      test: ["CMD", "nc", "-zv", "localhost", "9001"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

  shuaikv-3:
    build: .
    container_name: shuaikv-3
    ports:
      - "9003:9001"
    volumes:
      - shuaikv3-data:/data
    environment:
      - SHUAIKV_PORT=9001
      - SHUAIKV_NODE_ID=3
    networks:
      shuaikv-net:
        ipv4_address: 172.28.0.12
    depends_on:
      - shuaikv-1
    healthcheck:
      test: ["CMD", "nc", "-zv", "localhost", "9001"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

networks:
  shuaikv-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16

volumes:
  shuaikv1-data:
  shuaikv2-data:
  shuaikv3-data:
